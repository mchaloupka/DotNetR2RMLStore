# The R2RML mapping file for demography data

# ***
# Database tables:
# ***

#TABLE [dbo].[Ban](
#	[Id] [nvarchar](20) NOT NULL,
#	[CheckActionId] [nvarchar](20) NOT NULL,
#	[Object] [nvarchar](max) NOT NULL,
#	[Count] [int] NOT NULL,
#	[Price] [int] NOT NULL,
#	[Law] [nvarchar](max) NULL
#);

#TABLE [dbo].[CheckAction](
#	[Id] [nvarchar](20) NOT NULL,
#	[Date] [date] NOT NULL,
#	[Ic] [nvarchar](20) NULL
#);

#TABLE [dbo].[CheckActionLocation](
#	[Id] [nvarchar](20) NOT NULL,
#	[NUTS3] [nvarchar](5) NOT NULL,
#	[NUTS4] [nvarchar](6) NULL,
#	[NUTS5] [nvarchar](6) NULL,
#	[Street] [nvarchar](255) NULL,
#	[No] [int] NULL,
#	[Hn] [int] NULL,
#	[ZipCode] [int] NULL
#);

#TABLE [dbo].[CheckActionSubject](
#	[CheckActionId] [nvarchar](20) NOT NULL,
#	[LawId] [int] NOT NULL
#);

#CREATE TABLE [dbo].[Laws](
#	[LawId] [int] IDENTITY(1,1) NOT NULL,
#	[Law] [nvarchar](255) NOT NULL
#);

#TABLE [dbo].[Sanction](
#	[Id] [nvarchar](20) NOT NULL,
#	[CheckActionId] [nvarchar](20) NOT NULL,
#	[Sanction] [int] NOT NULL,
#	[Date] [date] NOT NULL
#);

#TABLE [dbo].[SanctionReason](
#	[SanctionReasonId] [int] IDENTITY(1,1) NOT NULL,
#	[SactionId] [nvarchar](20) NOT NULL,
#	[LawId] [int] NULL,
#	[Article] [nvarchar](255) NULL
#);

@prefix rr: <http://www.w3.org/ns/r2rml#> .
@base <http://example.com/base/> .

@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix adms:    <http://www.w3.org/ns/adms#> .
@prefix schema:  <http://schema.org/> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix void:    <http://rdfs.org/ns/void#> .
@prefix gr:      <http://purl.org/goodrelations/v1#> .
@prefix skos:    <http://www.w3.org/2004/02/skos/core#> .
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix odcz:    <http://linked.opendata.cz/ontology/coi.cz/> .


<#LawTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Laws]" ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/law/{LawId}";
		rr:class schema:Law;
	];
	rr:predicateObjectMap [
		rr:predicate rdfs:label;
		rr:objectMap [ rr:column "[Law]"; ];
	];		
.

<#CheckActionLocationTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[CheckActionLocation]" ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/check-action/{Id}/postal-address";
		rr:class schema:PostalAddress;
	];
	rr:predicateObjectMap [
		rr:predicate schema:location;
		rr:objectMap [
			rr:template "http://ec.europa.eu/eurostat/ramon/rdfdata/nuts2008/{NUTS3}";
		];
		rr:objectMap [
			rr:template "http://linked.opendata.cz/resource/region/{NUTS4}";
		];
		rr:objectMap [
			rr:template "http://linked.opendata.cz/resource/region/{NUTS5}";
		];
	];
	rr:predicateObjectMap [
		rr:predicate schema:streetAddress;
		rr:objectMap [ rr:column "[Street]"; ];
	];
	rr:predicateObjectMap [
		rr:predicate schema:postalCode;
		rr:objectMap [ rr:column "[ZipCode]"; ];
	];
	rr:predicateObjectMap [
		rr:predicate schema:no;
		rr:objectMap [ rr:column "[No]"; ];
	];
	rr:predicateObjectMap [
		rr:predicate schema:HouseNumber;
		rr:objectMap [ rr:column "[Hn]"; ];
	];
.

<#CheckActionSubjectTriplesMapToLaws> rr:parentTriplesMap <#LawTriples>;
	rr:joinCondition [
		rr:child "[LawId]";
		rr:parent "[LawId]";		
	];
.

<#CheckActionSubjectTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[CheckActionSubject]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/check-action/{CheckActionId}/subject";
		rr:class schema:CheckActionSubject;
	];
	rr:predicateObjectMap [
		rr:predicate odcz:zakon;
		rr:objectMap <#CheckActionSubjectTriplesMapToLaws>;
	];
.

<#BanItemDescriptionTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Ban]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/ban/{Id}/some-items";
		rr:class gr:SomeItems;
	];
	rr:predicateObjectMap [
		rr:predicate gr:category;
		rr:objectMap [ rr:column "[Object]"; ]
	];
.

<#BanItemTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Ban]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/ban/{Id}/type-and-quantity-node";
		rr:class gr:TypeAndQuantityNode;
	];
	rr:predicateObjectMap [
		rr:predicate gr:amountOfThisGood;
		rr:objectMap [ rr:column "[Count]"; ];
		rr:datatype xsd:decimal;
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasUnitOfMeasurement;
		rr:object "C62";
	];
	rr:predicateObjectMap [
		rr:predicate gr:includesObject;
		rr:objectMap [
			rr:parentTriplesMap <#BanItemDescriptionTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[Id]";
			];
		];
	];
.

<#BanItemPriceTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Ban]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/ban/{Id}/price-specification";
		rr:class odcz:Fine;
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasCurrency;
		rr:object "CZK";
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasCurrencyValue;
		rr:objectMap [ rr:column "[Price]"; ];
		rr:datatype xsd:decimal;
	];
.

<#BanTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Ban]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/ban/{Id}";
		rr:class odcz:Ban;
	];
	rr:predicateObjectMap [
		rr:predicate odcz:zakon;
		rr:objectMap [ rr:column "[Law]"; ];
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasPriceSpecification;
		rr:objectMap [
			rr:parentTriplesMap <#BanItemPriceTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[Id]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate gr:includesObject;
		rr:objectMap [
			rr:parentTriplesMap <#BanItemTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[Id]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate void:inDataset;
		rr:object <http://linked.opendata.cz/resource/dataset/coi.cz/kontroly-sankce-zakazy>;
	];
	rr:predicateObjectMap [
		rr:predicate skos:notation;
		rr:objectMap [ rr:column "[Id]"; ];
	];
.

<#SanctionPriceTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Sanction]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/sanction/{Id}/price-specification";
		rr:class odcz:Fine;
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasCurrency;
		rr:object "CZK";
	];
	rr:predicateObjectMap [
		rr:predicate gr:hasCurrencyValue;
		rr:objectMap [ rr:column "[Sanction]" ];
		rr:datatype xsd:decimal;
	];
.

<#SanctionReasonTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[SanctionReason]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/sanction/{SactionId}/reason/{SanctionReasonId}";
		rr:class odcz:SanctionReason;
	];
	rr:predicateObjectMap [
		rr:predicate odcz:zakon;
		rr:objectMap [
			rr:parentTriplesMap <#LawTriples>;
			rr:joinCondition [
				rr:child "[LawId]";
				rr:parent "[LawId]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate odcz:paragraf;
		rr:objectMap [ rr:column "[Article]"; ];
	];
.

<#SanctionTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[Sanction]"; ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/sanction/{Id}";
		rr:class odcz:Sanction;
	];
	rr:predicateObjectMap [
		rr:predicate dcterms:valid;
		rr:objectMap [ rr:column "[Date]"; ];
		rr:datatype xsd:date;
	];
	rr:predicateObjectMap [
		rr:predicate void:inDataset;
		rr:object <http://linked.opendata.cz/resource/dataset/coi.cz/kontroly-sankce-zakazy>;
	];
	rr:predicateObjectMap [
		rr:predicate schema:result;
		rr:objectMap [
			rr:parentTriplesMap <#SanctionPriceTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[Id]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate schema:reason;
		rr:objectMap [
			rr:parentTriplesMap <#SanctionReasonTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[SanctionId]";
			];	
		];
	];
	rr:predicateObjectMap [
		rr:predicate skos:notation;
		rr:objectMap [ rr:column "[Id]"; ];
	];
.

<#CheckActionTriples> a rr:TriplesMap;
	rr:logicalTable [ rr:tableName "[dbo].[CheckAction]" ];
	rr:subjectMap [
		rr:template "http://linked.opendata.cz/resource/domain/coi.cz/check-action/{Id}";
		rr:class schema:CheckAction;
	];
	rr:predicateObjectMap [
		rr:predicate dcterms:date;
		rr:objectMap [ rr:column "[Date]"; ];
		rr:datatype xsd:date;
	];
	rr:predicateObjectMap [
		rr:predicate void:inDataset;
		rr:object <http://linked.opendata.cz/resource/dataset/coi.cz/kontroly-sankce-zakazy>;
	];
	rr:predicateObjectMap [
		rr:predicate schema:agent;
		rr:object <http://www.coi.cz/>;
	];
	rr:predicateObjectMap [
		rr:predicate schema:location;
		rr:objectMap [
			rr:parentTriplesMap <#CheckActionLocationTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[Id]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate schema:subject;
		rr:objectMap [
			rr:parentTriplesMap <#CheckActionSubjectTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[CheckActionId]";
			];
		];
	];
	rr:predicateObjectMap [
		rr:predicate skos:notation;
		rr:objectMap [ rr:column "[Id]"; ];
	];
	rr:predicateObjectMap [
		rr:predicate schema:object;
		rr:objectMap [
			rr:template "http://linked.opendata.cz/resource/business-entity/CZ{Ic}";	
		];
	];
	rr:predicateObjectMap [
		rr:predicate schema:result;
		rr:objectMap [
			rr:parentTriplesMap <#BanTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[CheckActionId]";
			];
		];
		rr:objectMap [
			rr:parentTriplesMap <#SanctionTriples>;
			rr:joinCondition [
				rr:child "[Id]";
				rr:parent "[CheckActionId]";
			];
		];
	];
.